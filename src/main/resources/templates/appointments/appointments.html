<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Đặt lịch tiêm</title>
    <meta charset="UTF-8">
    <link rel="stylesheet" th:href="@{/css/style.css}">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>

</head>
<body class="bg-light">
    <div class="page-container">
        <!-- Back to Home Button -->
        <a href="/" class="btn btn-outline-primary back-button">
            <i class="bi bi-arrow-left"></i> Trang chủ
        </a>
        
        <div class="container">
            <h1><i class="bi bi-calendar-check"></i> Đặt lịch tiêm chủng cho trẻ</h1>

            <!-- Form thêm bé mới -->
            <div id="addChildSection" class="mb-4 p-4 bg-white rounded shadow-sm">
                <h2><i class="bi bi-person-plus"></i> Thêm hồ sơ trẻ</h2>
                <form id="addChildForm" class="row g-3">
                    <div class="col-md-6">
                        <label for="childName" class="form-label">Tên bé:</label>
                        <input type="text" class="form-control" id="childName" name="childName" required>
                    </div>
                    
                    <div class="col-md-3">
                        <label for="childDob" class="form-label">Ngày sinh:</label>
                        <input type="date" class="form-control" id="childDob" name="childDob" required>
                    </div>
                    
                    <div class="col-md-3">
                        <label for="childGender" class="form-label">Giới tính:</label>
                        <select class="form-select" id="childGender" name="childGender" required>
                            <option value="male">Nam</option>
                            <option value="female">Nữ</option>
                        </select>
                    </div>
                    
                    <div class="col-12 mt-3">
                        <button type="submit" class="btn btn-primary">
                            <i class="bi bi-person-plus"></i> Thêm hồ sơ
                        </button>
                    </div>
                </form>
                <div id="addChildMessage" class="mt-2"></div>
            </div>

            <!-- Tabs for individual vaccines vs packages -->
            <ul class="nav nav-tabs" id="appointmentTabs" role="tablist">
                <li class="nav-item" role="presentation">
                    <button class="nav-link active" id="vaccine-tab" data-bs-toggle="tab" data-bs-target="#vaccine-content" type="button" role="tab" aria-controls="vaccine-content" aria-selected="true">
                        <i class="bi bi-syringe"></i> Tiêm vắc xin đơn lẻ
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="package-tab" data-bs-toggle="tab" data-bs-target="#package-content" type="button" role="tab" aria-controls="package-content" aria-selected="false">
                        <i class="bi bi-box"></i> Tiêm theo gói vắc xin
                    </button>
                </li>
            </ul>

            <div class="tab-content" id="appointmentTabsContent">
                <!-- Individual Vaccine Appointment Tab -->
                <div class="tab-pane fade show active" id="vaccine-content" role="tabpanel" aria-labelledby="vaccine-tab">
                    <h2><i class="bi bi-syringe"></i> Đặt lịch tiêm vắc xin đơn lẻ</h2>
                    <form id="vaccineAppointmentForm" class="row g-3">
                        <div class="col-md-6">
                            <label for="vaccineChildId" class="form-label"><i class="bi bi-person-check"></i> Chọn bé:</label>
                            <select class="form-select" id="vaccineChildId" name="childId" required>
                                <option value="">-- Vui lòng chọn --</option>
                            </select>
                        </div>

                        <div class="col-md-6">
                            <label for="vaccineId" class="form-label"><i class="bi bi-shield-check"></i> Chọn vắc xin:</label>
                            <select class="form-select" id="vaccineId" name="vaccineId" required>
                                <option value="">-- Vui lòng chọn --</option>
                            </select>
                        </div>

                        <div class="col-md-6">
                            <label for="vaccineAppointmentDate" class="form-label"><i class="bi bi-calendar2-date"></i> Ngày tiêm:</label>
                            <input type="date" class="form-control" id="vaccineAppointmentDate" name="appointmentDate" required>
                        </div>

                        <div class="col-md-6">
                            <label for="vaccineAppointmentTime" class="form-label"><i class="bi bi-clock"></i> Giờ tiêm:</label>
                            <input type="time" class="form-control" id="vaccineAppointmentTime" name="appointmentTime" required>
                        </div>

                        <div class="col-12">
                            <label for="vaccineNotes" class="form-label"><i class="bi bi-chat-left-text"></i> Ghi chú:</label>
                            <textarea class="form-control" id="vaccineNotes" name="notes" rows="2" placeholder="Thông tin bổ sung về tình trạng sức khỏe của bé"></textarea>
                        </div>

                        <div class="col-12 mt-4 text-center">
                            <button type="submit" class="btn btn-primary px-4">
                                <i class="bi bi-calendar-plus"></i> Đặt lịch tiêm
                            </button>
                        </div>
                    </form>
                    <div id="vaccineMessage" class="mt-3"></div>
                </div>

                <!-- Package Appointment Tab -->
                <div class="tab-pane fade" id="package-content" role="tabpanel" aria-labelledby="package-tab">
                    <h2>Đặt lịch tiêm theo gói vắc xin</h2>
                    
                    <!-- Package selection section -->
                    <div class="mb-4">
                        <div class="d-flex justify-content-between align-items-center mb-3">
                            <h5 class="mb-0">Chọn gói vắc xin</h5>
                            <div class="btn-group" role="group">
                                <button type="button" class="btn btn-outline-primary btn-sm" id="btnAllPackages" onclick="filterPackages('all')">Tất cả</button>
                                <button type="button" class="btn btn-outline-primary btn-sm" id="btnStandardPackages" onclick="filterPackages('PACKAGE')">Trọn gói</button>
                                <button type="button" class="btn btn-outline-primary btn-sm" id="btnCustomPackages" onclick="filterPackages('CUSTOM')">Cá thể hóa</button>
                            </div>
                        </div>
                        
                        <div id="packagesContainer" class="row">
                            <!-- Packages will be loaded here -->
                            <div class="col-12 text-center py-4">
                                <div class="spinner-border text-primary" role="status">
                                    <span class="visually-hidden">Loading...</span>
                                </div>
                                <p class="mt-2">Đang tải dữ liệu gói vắc xin...</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Package appointment form -->
                    <form id="packageAppointmentForm" class="row g-3">
                        <input type="hidden" id="selectedPackageId" name="packageId">
                        
                        <div class="col-md-6">
                            <label for="packageChildId" class="form-label">Chọn bé:</label>
                            <select class="form-select" id="packageChildId" name="childId" required></select>
                        </div>

                        <div class="col-md-6">
                            <label for="packageAppointmentDate" class="form-label">Ngày tiêm:</label>
                            <input type="date" class="form-control" id="packageAppointmentDate" name="appointmentDate" required>
                        </div>

                        <div class="col-md-6">
                            <label for="packageAppointmentTime" class="form-label">Giờ tiêm:</label>
                            <input type="time" class="form-control" id="packageAppointmentTime" name="appointmentTime" required>
                        </div>

                        <div class="col-12">
                            <label for="packageNotes" class="form-label">Ghi chú:</label>
                            <textarea class="form-control" id="packageNotes" name="notes" rows="2"></textarea>
                        </div>

                        <div class="col-12 mt-3">
                            <button type="submit" class="btn btn-primary" id="btnBookPackage" disabled>Đặt lịch</button>
                            <span id="packageSelectionWarning" class="text-danger ms-2">Vui lòng chọn gói vắc xin</span>
                        </div>
                    </form>
                    <div id="packageMessage" class="mt-2"></div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script th:src="@{/js/main.js}"></script>
   
</body>
</html>
